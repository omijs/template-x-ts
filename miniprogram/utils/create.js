"use strict";
/*!
 *  omix v2.4.0 by dntzhang
 *  Github: https://github.com/Tencent/omi
 *  MIT Licensed.
*/
Object.defineProperty(exports, "__esModule", { value: true });
var obaa_1 = require("./obaa");
var path_1 = require("./path");
function create(store, option) {
    if (arguments.length === 2) {
        if (!store.instances) {
            store.instances = {};
        }
        if (!store.__changes_) {
            store.__changes_ = [];
        }
        var changes_1 = store.__changes_;
        if (!store.onChange) {
            store.onChange = function (fn) {
                changes_1.push(fn);
            };
        }
        if (!store.offChange) {
            store.offChange = function (fn) {
                for (var i = 0, len = changes_1.length; i < len; i++) {
                    if (changes_1[i] === fn) {
                        changes_1.splice(i, 1);
                        break;
                    }
                }
            };
        }
        var hasData_1 = typeof option.data !== 'undefined';
        var clone_1;
        if (option.data) {
            clone_1 = JSON.parse(JSON.stringify(option.data));
            option.data.$ = store.data;
        }
        else {
            option.data = store.data;
        }
        observeStore(store);
        var onLoad_1 = option.onLoad;
        var onUnload_1 = option.onUnload;
        option.onLoad = function (e) {
            this.store = store;
            option.use && (this.__updatePath = path_1.getPath(option.use));
            this.__use = option.use;
            this.__hasData = hasData_1;
            if (hasData_1) {
                Object.assign(option.data, JSON.parse(JSON.stringify(clone_1)));
            }
            store.instances[this.route] = store.instances[this.route] || [];
            store.instances[this.route].push(this);
            this.computed = option.computed;
            this.setData(option.data);
            var using = path_1.getUsing(store.data, option.use);
            option.computed && compute(option.computed, store, using, this);
            this.setData(using);
            onLoad_1 && onLoad_1.call(this, e);
        };
        option.onUnload = function (e) {
            var _this = this;
            store.instances[this.route] = store.instances[this.route].filter(function (ins) { return ins !== _this; });
            onUnload_1 && onUnload_1.call(this, e);
        };
        Page(option);
    }
    else {
        store.lifetimes = store.lifetimes || {};
        var ready_1 = store.lifetimes.ready || store.ready;
        store.ready = store.lifetimes.ready = function () {
            var page = getCurrentPages()[getCurrentPages().length - 1];
            store.use && (this.__updatePath = path_1.getPath(store.use));
            this.store = page.store;
            this.__use = store.use;
            this.computed = store.computed;
            store.data = this.store.data;
            this.setData(store.data);
            var using = path_1.getUsing(this.store.data, store.use);
            store.computed && compute(store.computed, this.store, using, this);
            this.setData(using);
            page._omixComponents = page._omixComponents || [];
            page._omixComponents.push(this);
            ready_1 && ready_1.call(this);
        };
        Component(store);
    }
}
create.Page = function (store, option) {
    create(store, option);
};
create.Component = function (store, option) {
    if (arguments.length === 2) {
        if (!store.instances) {
            store.instances = {};
        }
        if (!store.__changes_) {
            store.__changes_ = [];
        }
        var changes_2 = store.__changes_;
        if (!store.onChange) {
            store.onChange = function (fn) {
                changes_2.push(fn);
            };
        }
        if (!store.offChange) {
            store.offChange = function (fn) {
                for (var i = 0, len = changes_2.length; i < len; i++) {
                    if (changes_2[i] === fn) {
                        changes_2.splice(i, 1);
                        break;
                    }
                }
            };
        }
        var hasData_2 = typeof option.data !== 'undefined';
        var clone_2;
        if (option.data) {
            clone_2 = JSON.parse(JSON.stringify(option.data));
            option.data.$ = store.data;
        }
        else {
            option.data = store.data;
        }
        observeStore(store);
        var detached_1 = option.detached;
        option.lifetimes = option.lifetimes || {};
        var created_1 = option.lifetimes.created || option.created;
        var ready_2 = option.lifetimes.ready || option.ready;
        option.created = option.lifetimes.created = function (e) {
            this.store = store;
            option.use && (this.__updatePath = path_1.getPath(option.use));
            this.__use = option.use;
            this.__hasData = hasData_2;
            if (hasData_2) {
                Object.assign(option.data, JSON.parse(JSON.stringify(clone_2)));
            }
            created_1 && created_1.call(this, e);
        };
        option.ready = option.lifetimes.ready = function (e) {
            var store = this.store;
            store.instances[this.is] = store.instances[this.is] || [];
            store.instances[this.is].push(this);
            this.computed = option.computed;
            this.setData(option.data);
            var using = path_1.getUsing(store.data, option.use);
            option.computed && compute(option.computed, store, using, this);
            this.setData(using);
            ready_2 && ready_2.call(this, e);
        };
        option.lifetimes.detached = option.detached = function (e) {
            var _this = this;
            this.store.instances[this.is] = this.store.instances[this.is].filter(function (ins) { return ins !== _this; });
            detached_1 && detached_1.call(this, e);
        };
        Component(option);
    }
    else {
        store.lifetimes = store.lifetimes || {};
        var ready_3 = store.lifetimes.ready || store.ready;
        store.ready = store.lifetimes.ready = function () {
            var page = getCurrentPages()[getCurrentPages().length - 1];
            store.use && (this.__updatePath = path_1.getPath(store.use));
            this.store = page.store;
            this.__use = store.use;
            this.computed = store.computed;
            store.data = this.store.data;
            this.setData(store.data);
            var using = path_1.getUsing(this.store.data, store.use);
            store.computed && compute(store.computed, this.store, using, this);
            this.setData(using);
            page._omixComponents = page._omixComponents || [];
            page._omixComponents.push(this);
            ready_3 && ready_3.call(this);
        };
        Component(store);
    }
};
function compute(computed, store, using, scope) {
    for (var key in computed) {
        using[key] = computed[key].call(store.data, scope);
    }
}
function observeStore(store) {
    var oba = obaa_1.default(store.data, function (prop, value, old, path) {
        var patch = {};
        if (prop.indexOf('Array-push') === 0) {
            var dl = value.length - old.length;
            for (var i = 0; i < dl; i++) {
                patch[path_1.fixPath(path + '-' + (old.length + i))] = value[(old.length + i)];
            }
        }
        else if (prop.indexOf('Array-') === 0) {
            patch[path_1.fixPath(path)] = value;
        }
        else {
            patch[path_1.fixPath(path + '-' + prop)] = value;
        }
        _update(patch, store);
    });
    if (!store.set) {
        store.set = function (obj, prop, val) {
            obaa_1.default.set(obj, prop, val, oba);
        };
    }
}
function _update(kv, store) {
    for (var key in store.instances) {
        store.instances[key].forEach(function (ins) {
            _updateOne(kv, store, ins);
            if (ins._omixComponents) {
                ins._omixComponents.forEach(function (compIns) {
                    _updateOne(kv, store, compIns);
                });
            }
        });
    }
    store.__changes_.forEach(function (change) {
        change(kv);
    });
    store.debug && storeChangeLogger(store, kv);
}
function _updateOne(kv, store, ins) {
    if (store.updateAll || ins.__updatePath && path_1.needUpdate(kv, ins.__updatePath)) {
        if (ins.__hasData) {
            var patch = Object.assign({}, kv);
            for (var pk in patch) {
                if (!/\$\./.test(pk)) {
                    patch['$.' + pk] = kv[pk];
                    delete patch[pk];
                }
            }
            ins.setData.call(ins, patch);
        }
        else {
            ins.setData.call(ins, kv);
        }
        var using = path_1.getUsing(store.data, ins.__use);
        compute(ins.computed, store, using, ins);
        ins.setData(using);
    }
}
function storeChangeLogger(store, diffResult) {
    try {
        var preState = wx.getStorageSync("CurrentState") || {};
        var title = "Data Changed";
        console.groupCollapsed("%c  " + title + " %c " + Object.keys(diffResult), 'color:#e0c184; font-weight: bold', 'color:#f0a139; font-weight: bold');
        console.log("%c    Pre Data", 'color:#ff65af; font-weight: bold', preState);
        console.log("%c Change Data", 'color:#3d91cf; font-weight: bold', diffResult);
        console.log("%c   Next Data", 'color:#2c9f67; font-weight: bold', store.data);
        console.groupEnd();
        wx.setStorageSync("CurrentState", store.data);
    }
    catch (e) {
        console.log(e);
    }
}
create.obaa = obaa_1.default;
exports.default = create;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY3JlYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7OztFQUlFOztBQUVGLCtCQUF5QjtBQUN6QiwrQkFBK0Q7QUE4Si9ELFNBQVMsTUFBTSxDQUFDLEtBQTRCLEVBQUUsTUFBbUI7SUFDL0QsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRTtZQUNwQixLQUFLLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQTtTQUNyQjtRQUVELElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFO1lBQ3JCLEtBQUssQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFBO1NBQ3RCO1FBRUQsSUFBTSxTQUFPLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQTtRQUNoQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRTtZQUNuQixLQUFLLENBQUMsUUFBUSxHQUFHLFVBQVUsRUFBdUI7Z0JBQ2hELFNBQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7WUFDbEIsQ0FBQyxDQUFBO1NBQ0Y7UUFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRTtZQUNwQixLQUFLLENBQUMsU0FBUyxHQUFHLFVBQVUsRUFBdUI7Z0JBQ2pELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxTQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ2xELElBQUksU0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTt3QkFDckIsU0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7d0JBQ3BCLE1BQUs7cUJBQ047aUJBQ0Y7WUFDSCxDQUFDLENBQUE7U0FDRjtRQUVELElBQU0sU0FBTyxHQUFHLE9BQU8sTUFBTSxDQUFDLElB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LjQuMCBieSBkbnR6aGFuZ1xuICogIEdpdGh1YjogaHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvb21pXG4gKiAgTUlUIExpY2Vuc2VkLlxuKi9cblxuaW1wb3J0IG9iYWEgZnJvbSAnLi9vYmFhJ1xuaW1wb3J0IHsgZ2V0UGF0aCwgbmVlZFVwZGF0ZSwgZml4UGF0aCwgZ2V0VXNpbmcgfSBmcm9tICcuL3BhdGgnXG5cblxuaW50ZXJmYWNlIFN0b3JlQ2hhbmdlQ2FsbGJhY2sge1xuICAoZGV0YWlsOiBhbnkpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVBhZ2VTY3JvbGxPcHRpb24ge1xuICAvKiog6aG16Z2i5Zyo5Z6C55u05pa55ZCR5bey5rua5Yqo55qE6Led56a777yI5Y2V5L2NcHjvvIkgKi9cbiAgc2Nyb2xsVG9wOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBJVGFiSXRlbVRhcE9wdGlvbiB7XG4gIC8qKiDooqvngrnlh7t0YWJJdGVt55qE5bqP5Y+377yM5LuOMOW8gOWni++8jOacgOS9juWfuuehgOW6k++8miBgMS45LjBgICovXG4gIGluZGV4OiBzdHJpbmc7XG4gIC8qKiDooqvngrnlh7t0YWJJdGVt55qE6aG16Z2i6Lev5b6E77yM5pyA5L2O5Z+656GA5bqT77yaIGAxLjkuMGAgKi9cbiAgcGFnZVBhdGg6IHN0cmluZztcbiAgLyoqIOiiq+eCueWHu3RhYkl0ZW3nmoTmjInpkq7mloflrZfvvIzmnIDkvY7ln7rnoYDlupPvvJogYDEuOS4wYCAqL1xuICB0ZXh0OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJU2hhcmVBcHBNZXNzYWdlT3B0aW9uIHtcbiAgLyoqIOi9rOWPkeS6i+S7tuadpea6kOOAglxuICAgKlxuICAgKiDlj6/pgInlgLzvvJpcbiAgICogLSBgYnV0dG9uYO+8mumhtemdouWGhei9rOWPkeaMiemSru+8m1xuICAgKiAtIGBtZW51YO+8muWPs+S4iuinkui9rOWPkeiPnOWNleOAglxuICAgKlxuICAgKiDmnIDkvY7ln7rnoYDlupPvvJogYDEuMi40YFxuICAgKi9cbiAgZnJvbTogJ2J1dHRvbicgfCAnbWVudScgfCBzdHJpbmc7XG4gIC8qKiDlpoLmnpwgYGZyb21gIOWAvOaYryBgYnV0dG9uYO+8jOWImSBgdGFyZ2V0YCDmmK/op6blj5Hov5nmrKHovazlj5Hkuovku7bnmoQgYGJ1dHRvbmDvvIzlkKbliJnkuLogYHVuZGVmaW5lZGBcbiAgICpcbiAgICog5pyA5L2O5Z+656GA5bqT77yaIGAxLjIuNGAgKi9cbiAgdGFyZ2V0OiBhbnk7XG4gIC8qKiDpobXpnaLkuK3ljIXlkKtgPHdlYi12aWV3PmDnu4Tku7bml7bvvIzov5Tlm57lvZPliY1gPHdlYi12aWV3PmDnmoR1cmxcbiAgICpcbiAgICog5pyA5L2O5Z+656GA5bqT77yaIGAxLjYuNGBcbiAgICovXG4gIHdlYlZpZXdVcmw/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJQ3VzdG9tU2hhcmVDb250ZW50IHtcbiAgLyoqIOi9rOWPkeagh+mimOOAgum7mOiupOWAvO+8muW9k+WJjeWwj+eoi+W6j+WQjeensCAqL1xuICB0aXRsZT86IHN0cmluZztcbiAgLyoqIOi9rOWPkei3r+W+hO+8jOW/hemhu+aYr+S7pSAvIOW8gOWktOeahOWujOaVtOi3r+W+hOOAgum7mOiupOWAvO+8muW9k+WJjemhtemdoiBwYXRoICovXG4gIHBhdGg/OiBzdHJpbmc7XG4gIC8qKiDoh6rlrprkuYnlm77niYfot6/lvoTvvIzlj6/ku6XmmK/mnKzlnLDmlofku7bot6/lvoTjgIHku6PnoIHljIXmlofku7bot6/lvoTmiJbogIXnvZHnu5zlm77niYfot6/lvoTjgILmlK/mjIFQTkflj4pKUEfjgILmmL7npLrlm77niYfplb/lrr3mr5TmmK8gNTo077yM5pyA5L2O5Z+656GA5bqT77yaIGAxLjUuMGDjgILpu5jorqTlgLzvvJrkvb/nlKjpu5jorqTmiKrlm74gKi9cbiAgaW1hZ2VVcmw/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBDb21wb25lbnRPcHRpb24ge1xuICBba2V5OiBzdHJpbmddOiBhbnlcbn1cblxuaW50ZXJmYWNlIENvbXB1dGVkIHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmludGVyZmFjZSBQYWdlT3B0aW9uIHtcbiAgW2tleTogc3RyaW5nXTogYW55LFxuICAvKipcbiAgICog5L6d6LWWIHN0b3JlIOS4iueahCBwYXRoXG4gICAqL1xuICB1c2U/OiBBcnJheTxzdHJpbmcgfCBvYmplY3Q+XG4gIC8qKlxuICAgKiDorqHnrpflsZ7mgKdcbiAgICovXG4gIGNvbXB1dGVkPzogQ29tcHV0ZWQsXG4gIC8qKiDnlJ/lkb3lkajmnJ/lm57osIPigJTnm5HlkKzpobXpnaLliqDovb1cbiAgICpcbiAgICog6aG16Z2i5Yqg6L295pe26Kem5Y+R44CC5LiA5Liq6aG16Z2i5Y+q5Lya6LCD55So5LiA5qyh77yM5Y+v5Lul5ZyoIG9uTG9hZCDnmoTlj4LmlbDkuK3ojrflj5bmiZPlvIDlvZPliY3pobXpnaLot6/lvoTkuK3nmoTlj4LmlbDjgIJcbiAgICovXG4gIG9uTG9hZD8oXG4gICAgLyoqIOaJk+W8gOW9k+WJjemhtemdoui3r+W+hOS4reeahOWPguaVsCAqL1xuICAgIHF1ZXJ5PzogeyBbcXVlcnlLZXk6IHN0cmluZ106IHN0cmluZyB9LFxuICApOiB2b2lkO1xuICAvKiog55Sf5ZG95ZGo5pyf5Zue6LCD4oCU55uR5ZCs6aG16Z2i5pi+56S6XG4gICAqXG4gICAqIOmhtemdouaYvuekui/liIflhaXliY3lj7Dml7bop6blj5HjgIJcbiAgICovXG4gIG9uU2hvdz8oKTogdm9pZDtcbiAgLyoqIOeUn+WRveWRqOacn+Wbnuiwg+KAlOebkeWQrOmhtemdouWIneasoea4suafk+WujOaIkFxuICAgKlxuICAgKiDpobXpnaLliJ3mrKHmuLLmn5PlrozmiJDml7bop6blj5HjgILkuIDkuKrpobXpnaLlj6rkvJrosIPnlKjkuIDmrKHvvIzku6PooajpobXpnaLlt7Lnu4/lh4blpIflpqXlvZPvvIzlj6/ku6Xlkozop4blm77lsYLov5vooYzkuqTkupLjgIJcbiAgICpcblxuICAgKiDms6jmhI/vvJrlr7nnlYzpnaLlhoXlrrnov5vooYzorr7nva7nmoQgQVBJIOWmgmB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGVg77yM6K+35ZyoYG9uUmVhZHlg5LmL5ZCO6L+b6KGM44CCXG4gICovXG4gIG9uUmVhZHk/KCk6IHZvaWQ7XG4gIC8qKiDnlJ/lkb3lkajmnJ/lm57osIPigJTnm5HlkKzpobXpnaLpmpDol49cbiAgICpcbiAgICog6aG16Z2i6ZqQ6JePL+WIh+WFpeWQjuWPsOaXtuinpuWPkeOAgiDlpoIgYG5hdmlnYXRlVG9gIOaIluW6lemDqCBgdGFiYCDliIfmjaLliLDlhbbku5bpobXpnaLvvIzlsI/nqIvluo/liIflhaXlkI7lj7DnrYnjgIJcbiAgICovXG4gIG9uSGlkZT8oKTogdm9pZDtcbiAgLyoqIOeUn+WRveWRqOacn+Wbnuiwg+KAlOebkeWQrOmhtemdouWNuOi9vVxuICAgKlxuICAgKiDpobXpnaLljbjovb3ml7bop6blj5HjgILlpoJgcmVkaXJlY3RUb2DmiJZgbmF2aWdhdGVCYWNrYOWIsOWFtuS7lumhtemdouaXtuOAglxuICAgKi9cbiAgb25VbmxvYWQ/KCk6IHZvaWQ7XG4gIC8qKiDnm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcbiAgICpcbiAgICog55uR5ZCs55So5oi35LiL5ouJ5Yi35paw5LqL5Lu244CCXG4gICAqIC0g6ZyA6KaB5ZyoYGFwcC5qc29uYOeahGB3aW5kb3dg6YCJ6aG55Lit5oiW6aG16Z2i6YWN572u5Lit5byA5ZCvYGVuYWJsZVB1bGxEb3duUmVmcmVzaGDjgIJcbiAgICogLSDlj6/ku6XpgJrov4dgd3guc3RhcnRQdWxsRG93blJlZnJlc2hg6Kem5Y+R5LiL5ouJ5Yi35paw77yM6LCD55So5ZCO6Kem5Y+R5LiL5ouJ5Yi35paw5Yqo55S777yM5pWI5p6c5LiO55So5oi35omL5Yqo5LiL5ouJ5Yi35paw5LiA6Ie044CCXG4gICAqIC0g5b2T5aSE55CG5a6M5pWw5o2u5Yi35paw5ZCO77yMYHd4LnN0b3BQdWxsRG93blJlZnJlc2hg5Y+v5Lul5YGc5q2i5b2T5YmN6aG16Z2i55qE5LiL5ouJ5Yi35paw44CCXG4gICAqL1xuICBvblB1bGxEb3duUmVmcmVzaD8oKTogdm9pZDtcbiAgLyoqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKlxuICAgKiDnm5HlkKznlKjmiLfkuIrmi4nop6blupXkuovku7bjgIJcbiAgICogLSDlj6/ku6XlnKhgYXBwLmpzb25g55qEYHdpbmRvd2DpgInpobnkuK3miJbpobXpnaLphY3nva7kuK3orr7nva7op6blj5Hot53nprtgb25SZWFjaEJvdHRvbURpc3RhbmNlYOOAglxuICAgKiAtIOWcqOinpuWPkei3neemu+WGhea7keWKqOacn+mXtO+8jOacrOS6i+S7tuWPquS8muiiq+inpuWPkeS4gOasoeOAglxuICAgKi9cbiAgb25SZWFjaEJvdHRvbT8oKTogdm9pZDtcbiAgLyoqIOeUqOaIt+eCueWHu+WPs+S4iuinkui9rOWPkVxuICAgKlxuICAgKiDnm5HlkKznlKjmiLfngrnlh7vpobXpnaLlhoXovazlj5HmjInpkq7vvIhgPGJ1dHRvbj5gIOe7hOS7tiBgb3Blbi10eXBlPVwic2hhcmVcImDvvInmiJblj7PkuIrop5Loj5zljZXigJzovazlj5HigJ3mjInpkq7nmoTooYzkuLrvvIzlubboh6rlrprkuYnovazlj5HlhoXlrrnjgIJcbiAgICpcbiAgICogKirms6jmhI/vvJrlj6rmnInlrprkuYnkuobmraTkuovku7blpITnkIblh73mlbDvvIzlj7PkuIrop5Loj5zljZXmiY3kvJrmmL7npLrigJzovazlj5HigJ3mjInpkq4qKlxuICAgKlxuICAgKiDmraTkuovku7bpnIDopoEgcmV0dXJuIOS4gOS4qiBPYmplY3TvvIznlKjkuo7oh6rlrprkuYnovazlj5HlhoXlrrlcbiAgICovXG4gIG9uU2hhcmVBcHBNZXNzYWdlPyhcbiAgICAvKiog5YiG5Lqr5Y+R6LW35p2l5rqQ5Y+C5pWwICovXG4gICAgb3B0aW9ucz86IElTaGFyZUFwcE1lc3NhZ2VPcHRpb24sXG4gICk6IElDdXN0b21TaGFyZUNvbnRlbnQ7XG4gIC8qKiDpobXpnaLmu5rliqjop6blj5Hkuovku7bnmoTlpITnkIblh73mlbBcbiAgICpcbiAgICog55uR5ZCs55So5oi35ruR5Yqo6aG16Z2i5LqL5Lu244CCXG4gICAqL1xuICBvblBhZ2VTY3JvbGw/KFxuICAgIC8qKiDpobXpnaLmu5rliqjlj4LmlbAgKi9cbiAgICBvcHRpb25zPzogSVBhZ2VTY3JvbGxPcHRpb24sXG4gICk6IHZvaWQ7XG5cbiAgLyoqIOW9k+WJjeaYryB0YWIg6aG15pe277yM54K55Ye7IHRhYiDml7bop6blj5HvvIzmnIDkvY7ln7rnoYDlupPvvJogYDEuOS4wYCAqL1xuICBvblRhYkl0ZW1UYXA/KFxuICAgIC8qKiB0YWIg54K55Ye75Y+C5pWwICovXG4gICAgb3B0aW9ucz86IElUYWJJdGVtVGFwT3B0aW9uLFxuICApOiB2b2lkO1xuXG4gIC8qKiDnqpflj6PlsLrlr7jmlLnlj5jml7bop6blj5HvvIzmnIDkvY7ln7rnoYDlupPvvJpgMi40LjBgICovXG4gIG9uUmVzaXplPyhcbiAgICAvKiog56qX5Y+j5bC65a+45Y+C5pWwICovXG4gICAgb3B0aW9ucz86IElSZXNpemVPcHRpb24sXG4gICk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJUmVzaXplT3B0aW9uIHtcbiAgc2l6ZToge1xuICAgIC8qKiDlj5jljJblkI7nmoTnqpflj6Plrr3luqbvvIzljZXkvY0gcHggKi9cbiAgICB3aW5kb3dXaWR0aDogbnVtYmVyO1xuICAgIC8qKiDlj5jljJblkI7nmoTnqpflj6Ppq5jluqbvvIzljZXkvY0gcHggKi9cbiAgICB3aW5kb3dIZWlnaHQ6IG51bWJlcjtcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlKHN0b3JlOiBhbnkgfCBDb21wb25lbnRPcHRpb24sIG9wdGlvbj86IFBhZ2VPcHRpb24pIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICBpZiAoIXN0b3JlLmluc3RhbmNlcykge1xuICAgICAgc3RvcmUuaW5zdGFuY2VzID0ge31cbiAgICB9XG5cbiAgICBpZiAoIXN0b3JlLl9fY2hhbmdlc18pIHtcbiAgICAgIHN0b3JlLl9fY2hhbmdlc18gPSBbXVxuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZXMgPSBzdG9yZS5fX2NoYW5nZXNfXG4gICAgaWYgKCFzdG9yZS5vbkNoYW5nZSkge1xuICAgICAgc3RvcmUub25DaGFuZ2UgPSBmdW5jdGlvbiAoZm46IFN0b3JlQ2hhbmdlQ2FsbGJhY2spIHtcbiAgICAgICAgY2hhbmdlcy5wdXNoKGZuKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghc3RvcmUub2ZmQ2hhbmdlKSB7XG4gICAgICBzdG9yZS5vZmZDaGFuZ2UgPSBmdW5jdGlvbiAoZm46IFN0b3JlQ2hhbmdlQ2FsbGJhY2spIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNoYW5nZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBpZiAoY2hhbmdlc1tpXSA9PT0gZm4pIHtcbiAgICAgICAgICAgIGNoYW5nZXMuc3BsaWNlKGksIDEpXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGhhc0RhdGEgPSB0eXBlb2Ygb3B0aW9uLmRhdGEgIT09ICd1bmRlZmluZWQnXG4gICAgbGV0IGNsb25lXG4gICAgaWYgKG9wdGlvbi5kYXRhKSB7XG4gICAgICBjbG9uZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9uLmRhdGEpKVxuICAgICAgb3B0aW9uLmRhdGEuJCA9IHN0b3JlLmRhdGFcbiAgICB9IGVsc2Uge1xuICAgICAgb3B0aW9uLmRhdGEgPSBzdG9yZS5kYXRhXG4gICAgfVxuICAgIG9ic2VydmVTdG9yZShzdG9yZSlcbiAgICBjb25zdCBvbkxvYWQgPSBvcHRpb24ub25Mb2FkXG4gICAgY29uc3Qgb25VbmxvYWQgPSBvcHRpb24ub25VbmxvYWRcblxuICAgIG9wdGlvbi5vbkxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlXG5cbiAgICAgIG9wdGlvbi51c2UgJiYgKHRoaXMuX191cGRhdGVQYXRoID0gZ2V0UGF0aChvcHRpb24udXNlKSlcbiAgICAgIHRoaXMuX191c2UgPSBvcHRpb24udXNlXG4gICAgICB0aGlzLl9faGFzRGF0YSA9IGhhc0RhdGFcbiAgICAgIGlmIChoYXNEYXRhKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24ob3B0aW9uLmRhdGEsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2xvbmUpKSlcbiAgICAgIH1cbiAgICAgIHN0b3JlLmluc3RhbmNlc1t0aGlzLnJvdXRlXSA9IHN0b3JlLmluc3RhbmNlc1t0aGlzLnJvdXRlXSB8fCBbXVxuICAgICAgc3RvcmUuaW5zdGFuY2VzW3RoaXMucm91dGVdLnB1c2godGhpcylcbiAgICAgIHRoaXMuY29tcHV0ZWQgPSBvcHRpb24uY29tcHV0ZWRcbiAgICAgIHRoaXMuc2V0RGF0YShvcHRpb24uZGF0YSlcbiAgICAgIGNvbnN0IHVzaW5nID0gZ2V0VXNpbmcoc3RvcmUuZGF0YSwgb3B0aW9uLnVzZSlcblxuICAgICAgb3B0aW9uLmNvbXB1dGVkICYmIGNvbXB1dGUob3B0aW9uLmNvbXB1dGVkLCBzdG9yZSwgdXNpbmcsIHRoaXMpXG4gICAgICB0aGlzLnNldERhdGEodXNpbmcpXG5cbiAgICAgIG9uTG9hZCAmJiBvbkxvYWQuY2FsbCh0aGlzLCBlKVxuICAgIH1cblxuICAgIG9wdGlvbi5vblVubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBzdG9yZS5pbnN0YW5jZXNbdGhpcy5yb3V0ZV0gPSBzdG9yZS5pbnN0YW5jZXNbdGhpcy5yb3V0ZV0uZmlsdGVyKGlucyA9PiBpbnMgIT09IHRoaXMpXG4gICAgICBvblVubG9hZCAmJiBvblVubG9hZC5jYWxsKHRoaXMsIGUpXG4gICAgfVxuXG4gICAgUGFnZShvcHRpb24pXG4gIH0gZWxzZSB7XG4gICAgc3RvcmUubGlmZXRpbWVzID0gc3RvcmUubGlmZXRpbWVzIHx8IHt9XG4gICAgY29uc3QgcmVhZHkgPSBzdG9yZS5saWZldGltZXMucmVhZHkgfHwgc3RvcmUucmVhZHlcblxuICAgIHN0b3JlLnJlYWR5ID0gc3RvcmUubGlmZXRpbWVzLnJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcGFnZSA9IGdldEN1cnJlbnRQYWdlcygpW2dldEN1cnJlbnRQYWdlcygpLmxlbmd0aCAtIDFdXG4gICAgICBzdG9yZS51c2UgJiYgKHRoaXMuX191cGRhdGVQYXRoID0gZ2V0UGF0aChzdG9yZS51c2UpKVxuICAgICAgdGhpcy5zdG9yZSA9IHBhZ2Uuc3RvcmVcbiAgICAgIHRoaXMuX191c2UgPSBzdG9yZS51c2VcblxuICAgICAgdGhpcy5jb21wdXRlZCA9IHN0b3JlLmNvbXB1dGVkXG4gICAgICBzdG9yZS5kYXRhID0gdGhpcy5zdG9yZS5kYXRhXG4gICAgICB0aGlzLnNldERhdGEoc3RvcmUuZGF0YSlcbiAgICAgIGNvbnN0IHVzaW5nID0gZ2V0VXNpbmcodGhpcy5zdG9yZS5kYXRhLCBzdG9yZS51c2UpXG5cbiAgICAgIHN0b3JlLmNvbXB1dGVkICYmIGNvbXB1dGUoc3RvcmUuY29tcHV0ZWQsIHRoaXMuc3RvcmUsIHVzaW5nLCB0aGlzKVxuICAgICAgdGhpcy5zZXREYXRhKHVzaW5nKVxuXG4gICAgICBwYWdlLl9vbWl4Q29tcG9uZW50cyA9IHBhZ2UuX29taXhDb21wb25lbnRzIHx8IFtdXG4gICAgICBwYWdlLl9vbWl4Q29tcG9uZW50cy5wdXNoKHRoaXMpXG4gICAgICByZWFkeSAmJiByZWFkeS5jYWxsKHRoaXMpXG4gICAgfVxuICAgIENvbXBvbmVudChzdG9yZSlcbiAgfVxufVxuXG5jcmVhdGUuUGFnZSA9IGZ1bmN0aW9uIChzdG9yZTogYW55LCBvcHRpb24/OiBQYWdlT3B0aW9uKSB7XG4gIGNyZWF0ZShzdG9yZSwgb3B0aW9uKVxufVxuXG5jcmVhdGUuQ29tcG9uZW50ID0gZnVuY3Rpb24gKHN0b3JlOiBhbnkgfCBDb21wb25lbnRPcHRpb24sIG9wdGlvbj86IENvbXBvbmVudE9wdGlvbikge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGlmICghc3RvcmUuaW5zdGFuY2VzKSB7XG4gICAgICBzdG9yZS5pbnN0YW5jZXMgPSB7fVxuICAgIH1cblxuICAgIGlmICghc3RvcmUuX19jaGFuZ2VzXykge1xuICAgICAgc3RvcmUuX19jaGFuZ2VzXyA9IFtdXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlcyA9IHN0b3JlLl9fY2hhbmdlc19cbiAgICBpZiAoIXN0b3JlLm9uQ2hhbmdlKSB7XG4gICAgICBzdG9yZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICBjaGFuZ2VzLnB1c2goZm4pXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFzdG9yZS5vZmZDaGFuZ2UpIHtcbiAgICAgIHN0b3JlLm9mZkNoYW5nZSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY2hhbmdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGlmIChjaGFuZ2VzW2ldID09PSBmbikge1xuICAgICAgICAgICAgY2hhbmdlcy5zcGxpY2UoaSwgMSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGhhc0RhdGEgPSB0eXBlb2Ygb3B0aW9uLmRhdGEgIT09ICd1bmRlZmluZWQnXG4gICAgbGV0IGNsb25lXG4gICAgaWYgKG9wdGlvbi5kYXRhKSB7XG4gICAgICBjbG9uZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9uLmRhdGEpKVxuICAgICAgb3B0aW9uLmRhdGEuJCA9IHN0b3JlLmRhdGFcbiAgICB9IGVsc2Uge1xuICAgICAgb3B0aW9uLmRhdGEgPSBzdG9yZS5kYXRhXG4gICAgfVxuICAgIG9ic2VydmVTdG9yZShzdG9yZSlcblxuICAgIGNvbnN0IGRldGFjaGVkID0gb3B0aW9uLmRldGFjaGVkXG5cbiAgICBvcHRpb24ubGlmZXRpbWVzID0gb3B0aW9uLmxpZmV0aW1lcyB8fCB7fVxuICAgIGNvbnN0IGNyZWF0ZWQgPSBvcHRpb24ubGlmZXRpbWVzLmNyZWF0ZWQgfHwgb3B0aW9uLmNyZWF0ZWRcbiAgICBjb25zdCByZWFkeSA9IG9wdGlvbi5saWZldGltZXMucmVhZHkgfHwgb3B0aW9uLnJlYWR5XG5cbiAgICBvcHRpb24uY3JlYXRlZCA9IG9wdGlvbi5saWZldGltZXMuY3JlYXRlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLnN0b3JlID0gc3RvcmVcblxuICAgICAgb3B0aW9uLnVzZSAmJiAodGhpcy5fX3VwZGF0ZVBhdGggPSBnZXRQYXRoKG9wdGlvbi51c2UpKVxuICAgICAgdGhpcy5fX3VzZSA9IG9wdGlvbi51c2VcbiAgICAgIHRoaXMuX19oYXNEYXRhID0gaGFzRGF0YVxuICAgICAgaWYgKGhhc0RhdGEpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihvcHRpb24uZGF0YSwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjbG9uZSkpKVxuICAgICAgfVxuXG4gICAgICBjcmVhdGVkICYmIGNyZWF0ZWQuY2FsbCh0aGlzLCBlKVxuICAgIH1cblxuICAgIG9wdGlvbi5yZWFkeSA9IG9wdGlvbi5saWZldGltZXMucmVhZHkgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLnN0b3JlXG4gICAgICBzdG9yZS5pbnN0YW5jZXNbdGhpcy5yb3V0ZV0gPSBzdG9yZS5pbnN0YW5jZXNbdGhpcy5yb3V0ZV0gfHwgW11cbiAgICAgIHN0b3JlLmluc3RhbmNlc1t0aGlzLnJvdXRlXS5wdXNoKHRoaXMpXG4gICAgICB0aGlzLmNvbXB1dGVkID0gb3B0aW9uLmNvbXB1dGVkXG4gICAgICB0aGlzLnNldERhdGEob3B0aW9uLmRhdGEpXG4gICAgICBjb25zdCB1c2luZyA9IGdldFVzaW5nKHN0b3JlLmRhdGEsIG9wdGlvbi51c2UpXG5cbiAgICAgIG9wdGlvbi5jb21wdXRlZCAmJiBjb21wdXRlKG9wdGlvbi5jb21wdXRlZCwgc3RvcmUsIHVzaW5nLCB0aGlzKVxuICAgICAgdGhpcy5zZXREYXRhKHVzaW5nKVxuXG4gICAgICByZWFkeSAmJiByZWFkeS5jYWxsKHRoaXMsIGUpXG4gICAgfVxuXG4gICAgb3B0aW9uLmxpZmV0aW1lcy5kZXRhY2hlZCA9IG9wdGlvbi5kZXRhY2hlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLnN0b3JlLmluc3RhbmNlc1t0aGlzLnJvdXRlXSA9IHRoaXMuc3RvcmUuaW5zdGFuY2VzW3RoaXMucm91dGVdLmZpbHRlcihpbnMgPT4gaW5zICE9PSB0aGlzKVxuICAgICAgZGV0YWNoZWQgJiYgZGV0YWNoZWQuY2FsbCh0aGlzLCBlKVxuICAgIH1cblxuICAgIENvbXBvbmVudChvcHRpb24pXG4gIH0gZWxzZSB7XG4gICAgc3RvcmUubGlmZXRpbWVzID0gc3RvcmUubGlmZXRpbWVzIHx8IHt9XG4gICAgY29uc3QgcmVhZHkgPSBzdG9yZS5saWZldGltZXMucmVhZHkgfHwgc3RvcmUucmVhZHlcblxuICAgIHN0b3JlLnJlYWR5ID0gc3RvcmUubGlmZXRpbWVzLnJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcGFnZSA9IGdldEN1cnJlbnRQYWdlcygpW2dldEN1cnJlbnRQYWdlcygpLmxlbmd0aCAtIDFdXG4gICAgICBzdG9yZS51c2UgJiYgKHRoaXMuX191cGRhdGVQYXRoID0gZ2V0UGF0aChzdG9yZS51c2UpKVxuICAgICAgdGhpcy5zdG9yZSA9IHBhZ2Uuc3RvcmVcbiAgICAgIHRoaXMuX191c2UgPSBzdG9yZS51c2VcbiAgICAgIHRoaXMuY29tcHV0ZWQgPSBzdG9yZS5jb21wdXRlZFxuICAgICAgc3RvcmUuZGF0YSA9IHRoaXMuc3RvcmUuZGF0YVxuICAgICAgdGhpcy5zZXREYXRhKHN0b3JlLmRhdGEpXG4gICAgICBjb25zdCB1c2luZyA9IGdldFVzaW5nKHRoaXMuc3RvcmUuZGF0YSwgc3RvcmUudXNlKVxuXG4gICAgICBzdG9yZS5jb21wdXRlZCAmJiBjb21wdXRlKHN0b3JlLmNvbXB1dGVkLCB0aGlzLnN0b3JlLCB1c2luZywgdGhpcylcbiAgICAgIHRoaXMuc2V0RGF0YSh1c2luZylcblxuICAgICAgcGFnZS5fb21peENvbXBvbmVudHMgPSBwYWdlLl9vbWl4Q29tcG9uZW50cyB8fCBbXVxuICAgICAgcGFnZS5fb21peENvbXBvbmVudHMucHVzaCh0aGlzKVxuICAgICAgcmVhZHkgJiYgcmVhZHkuY2FsbCh0aGlzKVxuICAgIH1cbiAgICBDb21wb25lbnQoc3RvcmUpXG4gIH1cbn1cblxuZnVuY3Rpb24gY29tcHV0ZShjb21wdXRlZCwgc3RvcmUsIHVzaW5nLCBzY29wZSkge1xuICBmb3IgKGxldCBrZXkgaW4gY29tcHV0ZWQpIHtcbiAgICB1c2luZ1trZXldID0gY29tcHV0ZWRba2V5XS5jYWxsKHN0b3JlLmRhdGEsIHNjb3BlKVxuICB9XG59XG5cbmZ1bmN0aW9uIG9ic2VydmVTdG9yZShzdG9yZSkge1xuICBjb25zdCBvYmEgPSBvYmFhKHN0b3JlLmRhdGEsIChwcm9wLCB2YWx1ZSwgb2xkLCBwYXRoKSA9PiB7XG4gICAgbGV0IHBhdGNoID0ge31cbiAgICBpZiAocHJvcC5pbmRleE9mKCdBcnJheS1wdXNoJykgPT09IDApIHtcbiAgICAgIGxldCBkbCA9IHZhbHVlLmxlbmd0aCAtIG9sZC5sZW5ndGhcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGw7IGkrKykge1xuICAgICAgICBwYXRjaFtmaXhQYXRoKHBhdGggKyAnLScgKyAob2xkLmxlbmd0aCArIGkpKV0gPSB2YWx1ZVsob2xkLmxlbmd0aCArIGkpXVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAocHJvcC5pbmRleE9mKCdBcnJheS0nKSA9PT0gMCkge1xuICAgICAgcGF0Y2hbZml4UGF0aChwYXRoKV0gPSB2YWx1ZVxuICAgIH0gZWxzZSB7XG4gICAgICBwYXRjaFtmaXhQYXRoKHBhdGggKyAnLScgKyBwcm9wKV0gPSB2YWx1ZVxuICAgIH1cblxuICAgIF91cGRhdGUocGF0Y2gsIHN0b3JlKVxuXG5cbiAgfSlcblxuICBpZiAoIXN0b3JlLnNldCkge1xuICAgIHN0b3JlLnNldCA9IGZ1bmN0aW9uIChvYmosIHByb3AsIHZhbCkge1xuICAgICAgb2JhYS5zZXQob2JqLCBwcm9wLCB2YWwsIG9iYSlcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gX3VwZGF0ZShrdiwgc3RvcmUpIHtcbiAgZm9yIChsZXQga2V5IGluIHN0b3JlLmluc3RhbmNlcykge1xuICAgIHN0b3JlLmluc3RhbmNlc1trZXldLmZvckVhY2goaW5zID0+IHtcbiAgICAgIF91cGRhdGVPbmUoa3YsIHN0b3JlLCBpbnMpXG4gICAgICBpZihpbnMuX29taXhDb21wb25lbnRzKXtcbiAgICAgICAgaW5zLl9vbWl4Q29tcG9uZW50cy5mb3JFYWNoKGNvbXBJbnMgPT4ge1xuICAgICAgICAgIF91cGRhdGVPbmUoa3YsIHN0b3JlLCBjb21wSW5zKVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pXG4gIH1cbiAgc3RvcmUuX19jaGFuZ2VzXy5mb3JFYWNoKGNoYW5nZSA9PiB7XG4gICAgY2hhbmdlKGt2KVxuICB9KVxuICBzdG9yZS5kZWJ1ZyAmJiBzdG9yZUNoYW5nZUxvZ2dlcihzdG9yZSwga3YpXG59XG5cbmZ1bmN0aW9uIF91cGRhdGVPbmUoa3YsIHN0b3JlLCBpbnMpe1xuICBpZiAoc3RvcmUudXBkYXRlQWxsIHx8IGlucy5fX3VwZGF0ZVBhdGggJiYgbmVlZFVwZGF0ZShrdiwgaW5zLl9fdXBkYXRlUGF0aCkpIHtcbiAgICBpZiAoaW5zLl9faGFzRGF0YSkge1xuICAgICAgY29uc3QgcGF0Y2ggPSBPYmplY3QuYXNzaWduKHt9LCBrdilcbiAgICAgIGZvciAobGV0IHBrIGluIHBhdGNoKSB7XG4gICAgICAgIGlmICghL1xcJFxcLi8udGVzdChwaykpIHtcbiAgICAgICAgICBwYXRjaFsnJC4nICsgcGtdID0ga3ZbcGtdXG4gICAgICAgICAgZGVsZXRlIHBhdGNoW3BrXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpbnMuc2V0RGF0YS5jYWxsKGlucywgcGF0Y2gpXG4gICAgfSBlbHNlIHtcbiAgICAgIGlucy5zZXREYXRhLmNhbGwoaW5zLCBrdilcbiAgICB9XG5cbiAgICBjb25zdCB1c2luZyA9IGdldFVzaW5nKHN0b3JlLmRhdGEsIGlucy5fX3VzZSlcblxuICAgIGNvbXB1dGUoaW5zLmNvbXB1dGVkLCBzdG9yZSwgdXNpbmcsIGlucylcbiAgICBpbnMuc2V0RGF0YSh1c2luZylcblxuXG4gIH1cbn1cblxuZnVuY3Rpb24gc3RvcmVDaGFuZ2VMb2dnZXIoc3RvcmUsIGRpZmZSZXN1bHQpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwcmVTdGF0ZSA9IHd4LmdldFN0b3JhZ2VTeW5jKGBDdXJyZW50U3RhdGVgKSB8fCB7fVxuICAgIGNvbnN0IHRpdGxlID0gYERhdGEgQ2hhbmdlZGBcbiAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKGAlYyAgJHt0aXRsZX0gJWMgJHtPYmplY3Qua2V5cyhkaWZmUmVzdWx0KX1gLCAnY29sb3I6I2UwYzE4NDsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnY29sb3I6I2YwYTEzOTsgZm9udC13ZWlnaHQ6IGJvbGQnKVxuICAgIGNvbnNvbGUubG9nKGAlYyAgICBQcmUgRGF0YWAsICdjb2xvcjojZmY2NWFmOyBmb250LXdlaWdodDogYm9sZCcsIHByZVN0YXRlKVxuICAgIGNvbnNvbGUubG9nKGAlYyBDaGFuZ2UgRGF0YWAsICdjb2xvcjojM2Q5MWNmOyBmb250LXdlaWdodDogYm9sZCcsIGRpZmZSZXN1bHQpXG4gICAgY29uc29sZS5sb2coYCVjICAgTmV4dCBEYXRhYCwgJ2NvbG9yOiMyYzlmNjc7IGZvbnQtd2VpZ2h0OiBib2xkJywgc3RvcmUuZGF0YSlcbiAgICBjb25zb2xlLmdyb3VwRW5kKClcbiAgICB3eC5zZXRTdG9yYWdlU3luYyhgQ3VycmVudFN0YXRlYCwgc3RvcmUuZGF0YSlcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG4gIH1cblxufVxuXG5jcmVhdGUub2JhYSA9IG9iYWFcblxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVcbiJdfQ==
